'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var fs = _interopDefault(require('fs'));
var mem = _interopDefault(require('mem'));
var child_process = require('child_process');

let pathname = '/Applications/Sketch.app/Contents/Resources/sketchtool';

const bin = () => `${ pathname }/bin/sketchtool`;

const run = mem((...args) => {
  return new Promise((resolve, reject) => {
    child_process.execFile(bin(), args, (error, stdout, stderr) => {
      if (error) return reject(error);
      resolve(stdout);
    });
  });
});

var index = {
  get path() {
    return pathname;
  },

  set path(val) {
    pathname = val;
  },

  get bin() {
    return bin();
  },

  get installed() {
    return fs.existsSync(this.bin);
  },

  version() {
    return run('--version').then(out => Number(out.match(/(\d+)/)[0]));
  },

  dump(document) {
    return run('dump', document).then(out => JSON.parse(out));
  }
};

module.exports = index;
